<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Asistente de Dieta FODMAP</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        .tab-content {
            display: none;
        }
        .tab-content.active {
            display: block;
        }
        /* Custom scrollbar for results */
        .custom-scrollbar::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }
        .custom-scrollbar::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 10px;
        }
        .custom-scrollbar::-webkit-scrollbar-thumb {
            background: #a8a8a8;
            border-radius: 10px;
        }
        .custom-scrollbar::-webkit-scrollbar-thumb:hover {
            background: #555;
        }
        pre {
            white-space: pre-wrap;
            font-family: 'Inter', sans-serif;
        }
    </style>
</head>
<body class="bg-gray-50 text-gray-900">

    <div class="container mx-auto p-4 max-w-4xl">
        <header class="text-center my-6 md:my-10">
            <div class="mb-4 p-4 bg-gradient-to-r from-green-50 to-blue-50 rounded-2xl border border-green-200">
                <h2 class="text-xl md:text-2xl font-bold text-green-800 mb-2">¬°Bienvenido Carlos! üëã</h2>
                <p class="text-base md:text-lg text-gray-700">Y a todos nuestros invitados que buscan mejorar su bienestar digestivo.</p>
                <p class="text-sm text-gray-600 mt-1">Esperamos que esta herramienta te ayude en tu camino hacia una alimentaci√≥n m√°s saludable.</p>
            </div>
            <h1 class="text-3xl sm:text-4xl md:text-5xl font-extrabold text-green-700">Asistente de Dieta FODMAP</h1>
            <p class="text-base md:text-lg text-gray-600 mt-2">Tu gu√≠a para comer rico y sin malestar en M√©xico y LATAM.</p>
        </header>

        <main>
            <!-- Navegaci√≥n para Escritorio -->
            <nav id="desktop-nav" class="hidden md:flex justify-center mb-6 bg-white rounded-full shadow-md p-2 space-x-1">
                <button data-tab="search" class="nav-button px-4 py-3 font-semibold rounded-full flex items-center transition-all duration-300 bg-green-600 text-white shadow-lg">
                    <i data-lucide="search" class="mr-2"></i> Buscador
                </button>
                <button data-tab="dishes" class="nav-button px-4 py-3 font-semibold rounded-full flex items-center transition-all duration-300 text-gray-600 hover:bg-green-100">
                    <i data-lucide="utensils-crossed" class="mr-2"></i> Platillos
                </button>
                <button data-tab="guide" class="nav-button px-4 py-3 font-semibold rounded-full flex items-center transition-all duration-300 text-gray-600 hover:bg-green-100">
                    <i data-lucide="book-open" class="mr-2"></i> Gu√≠a
                </button>
                <button data-tab="planner" class="nav-button px-4 py-3 font-semibold rounded-full flex items-center transition-all duration-300 text-gray-600 hover:bg-green-100">
                    <i data-lucide="calendar-days" class="mr-2"></i> Planificador
                </button>
                <button data-tab="lists" class="nav-button px-4 py-3 font-semibold rounded-full flex items-center transition-all duration-300 text-gray-600 hover:bg-green-100">
                    <i data-lucide="list-plus" class="mr-2"></i> Listas
                </button>
                <button data-tab="phases" class="nav-button px-4 py-3 font-semibold rounded-full flex items-center transition-all duration-300 text-gray-600 hover:bg-green-100">
                    <i data-lucide="chevrons-right" class="mr-2"></i> Fases
                </button>
            </nav>

            <div class="bg-white/60 backdrop-blur-sm rounded-3xl shadow-2xl shadow-green-100 p-2 md:p-4">
                <!-- Contenido de las Pesta√±as -->
                <div id="search-content" class="tab-content active"></div>
                <div id="dishes-content" class="tab-content"></div>
                <div id="guide-content" class="tab-content"></div>
                <div id="planner-content" class="tab-content"></div>
                <div id="lists-content" class="tab-content"></div>
                <div id="phases-content" class="tab-content"></div>
            </div>
        </main>
        
        <!-- Navegaci√≥n para M√≥vil -->
        <nav id="mobile-nav" class="md:hidden fixed bottom-0 left-0 right-0 bg-white shadow-t-lg p-1 flex justify-around">
            <button data-tab="search" class="nav-button flex flex-col items-center justify-center w-full p-2 rounded-lg transition-colors duration-200 text-green-600">
                <i data-lucide="search"></i><span class="text-xs font-semibold mt-1">Buscador</span>
            </button>
            <button data-tab="dishes" class="nav-button flex flex-col items-center justify-center w-full p-2 rounded-lg transition-colors duration-200 text-gray-500">
                <i data-lucide="utensils-crossed"></i><span class="text-xs font-semibold mt-1">Platillos</span>
            </button>
            <button data-tab="guide" class="nav-button flex flex-col items-center justify-center w-full p-2 rounded-lg transition-colors duration-200 text-gray-500">
                <i data-lucide="book-open"></i><span class="text-xs font-semibold mt-1">Gu√≠a</span>
            </button>
            <button data-tab="planner" class="nav-button flex flex-col items-center justify-center w-full p-2 rounded-lg transition-colors duration-200 text-gray-500">
                <i data-lucide="calendar-days"></i><span class="text-xs font-semibold mt-1">Planificador</span>
            </button>
            <button data-tab="lists" class="nav-button flex flex-col items-center justify-center w-full p-2 rounded-lg transition-colors duration-200 text-gray-500">
                <i data-lucide="list-plus"></i><span class="text-xs font-semibold mt-1">Listas</span>
            </button>
            <button data-tab="phases" class="nav-button flex flex-col items-center justify-center w-full p-2 rounded-lg transition-colors duration-200 text-gray-500">
                <i data-lucide="chevrons-right"></i><span class="text-xs font-semibold mt-1">Fases</span>
            </button>
        </nav>

        <footer class="text-center text-gray-500 mt-10 mb-24 md:mb-10 text-sm">
            <p>Creado para facilitar tu camino con la dieta FODMAP.</p>
            <p>Consulta siempre a un profesional de la salud.</p>
        </footer>
    </div>

    <!-- Modal para el Planificador -->
    <div id="planner-modal" class="fixed inset-0 bg-black bg-opacity-50 flex justify-center items-center z-50 p-4 hidden">
        <div class="bg-white rounded-xl p-6 w-full max-w-md shadow-2xl">
            <h3 id="modal-title" class="text-xl font-bold mb-4">A√±adir/Editar Comida</h3>
            <p id="modal-subtitle" class="font-semibold mb-2"></p>
            <textarea id="modal-textarea" rows="4" class="w-full p-2 border-2 border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500" placeholder="Ej: Tacos de bistec en tortilla de ma√≠z con cilantro y salsa verde."></textarea>
            <div class="flex justify-end mt-4 space-x-2">
                <button id="modal-cancel" class="px-4 py-2 bg-gray-200 text-gray-800 rounded-lg hover:bg-gray-300 font-semibold">Cancelar</button>
                <button id="modal-save" class="px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 font-semibold">Guardar</button>
            </div>
        </div>
    </div>


<script>
document.addEventListener('DOMContentLoaded', () => {

    // --- DATOS DE ALIMENTOS ---
    const fodmapData = [
      { id: 11, name: 'Zanahoria', status: 'permitido', category: 'Verduras', notes: '' },
      { id: 12, name: 'Berenjena', status: 'permitido', category: 'Verduras', notes: '' },
      { id: 13, name: 'Lechuga', status: 'permitido', category: 'Verduras', notes: 'Tipos: iceberg, romana, etc.' },
      { id: 14, name: 'Calabaza', status: 'permitido', category: 'Verduras', notes: 'Tambi√©n zapallo. Con moderaci√≥n.' },
      { id: 15, name: 'Tomate (Jitomate)', status: 'permitido', category: 'Verduras', notes: 'Natural o en conserva (sin ajo/cebolla).' },
      { id: 16, name: 'Pimiento morr√≥n', status: 'permitido', category: 'Verduras', notes: 'Especialmente el rojo. Tambi√©n chile morr√≥n.' },
      { id: 17, name: 'Pepino', status: 'permitido', category: 'Verduras', notes: '' },
      { id: 18, name: 'Calabacita (zucchini)', status: 'permitido', category: 'Verduras', notes: 'Con moderaci√≥n.' },
      { id: 19, name: 'Espinacas', status: 'permitido', category: 'Verduras', notes: '' },
      { id: 35, name: 'Acelga', status: 'permitido', category: 'Verduras', notes: '' },
      { id: 39, name: 'Ceboll√≠n (parte verde)', status: 'permitido', category: 'Verduras', notes: 'Solo la parte verde. Tambi√©n rabo de cebolla.' },
      { id: 41, name: 'Jud√≠as verdes (ejotes)', status: 'permitido', category: 'Verduras', notes: 'En porciones moderadas (aprox. 15 unidades).' },
      { id: 45, name: 'Aceitunas (Olivas)', status: 'permitido', category: 'Verduras', notes: '' },
      { id: 76, name: 'Papa (Patata)', status: 'permitido', category: 'Verduras', notes: '' },
      { id: 77, name: 'Yuca (mandioca)', status: 'permitido', category: 'Verduras', notes: '' },
      { id: 78, name: 'Jengibre', status: 'permitido', category: 'Verduras', notes: '' },
      { id: 79, name: 'Chayote', status: 'permitido', category: 'Verduras', notes: '' },
      { id: 164, name: 'Nopal', status: 'permitido', category: 'Verduras', notes: 'En porciones moderadas (1 taza).' },
      { id: 165, name: 'Cilantro', status: 'permitido', category: 'Verduras', notes: '' },
      { id: 166, name: 'Tomatillo (tomate verde)', status: 'permitido', category: 'Verduras', notes: 'Con moderaci√≥n.' },
      { id: 167, name: 'Chile (jalape√±o, serrano)', status: 'permitido', category: 'Verduras', notes: 'El picante puede ser irritante, pero no es un FODMAP. Modera seg√∫n tu tolerancia al picante.' },
      { id: 20, name: 'Pl√°tano (no maduro)', status: 'permitido', category: 'Frutas', notes: 'Prefiere los que a√∫n est√°n algo verdes. Tambi√©n banana, guineo.' },
      { id: 21, name: 'Fresa (frutilla)', status: 'permitido', category: 'Frutas', notes: '' },
      { id: 22, name: 'Naranja', status: 'permitido', category: 'Frutas', notes: '' },
      { id: 23, name: 'Kiwi', status: 'permitido', category: 'Frutas', notes: '' },
      { id: 24, name: 'Uvas', status: 'permitido', category: 'Frutas', notes: 'Con moderaci√≥n.' },
      { id: 25, name: 'Pi√±a (anan√°)', status: 'permitido', category: 'Frutas', notes: '' },
      { id: 47, name: 'Lim√≥n / Lima', status: 'permitido', category: 'Frutas', notes: '' },
      { id: 48, name: 'Mandarina', status: 'permitido', category: 'Frutas', notes: '' },
      { id: 50, name: 'Papaya', status: 'permitido', category: 'Frutas', notes: '' },
      { id: 51, name: 'Frambuesas', status: 'permitido', category: 'Frutas', notes: 'En porciones peque√±as.' },
      { id: 168, name: 'Guayaba', status: 'prohibido', category: 'Frutas', notes: 'Alta en fructosa.' },
      { id: 3, name: 'Arroz', status: 'permitido', category: 'Cereales', notes: 'Blanco, integral, etc.' },
      { id: 4, name: 'Ma√≠z', status: 'permitido', category: 'Cereales', notes: 'Tortillas, tostadas, polenta, arepas (si son 100% ma√≠z).' },
      { id: 6, name: 'Quinoa', status: 'permitido', category: 'Cereales', notes: '' },
      { id: 58, name: 'Productos sin gluten', status: 'permitido', category: 'Cereales', notes: 'Pan, pasta, galletas. Revisar ingredientes.' },
      { id: 169, name: 'Avena', status: 'permitido', category: 'Cereales', notes: 'Certificada sin gluten. Limitar a 1/2 taza.' },
      { id: 170, name: 'Amaranto', status: 'prohibido', category: 'Cereales', notes: 'Alto en fructanos.' },
      { id: 28, name: 'Res, Cerdo, Cordero', status: 'permitido', category: 'Prote√≠nas', notes: 'Sin marinar con ajo/cebolla.' },
      { id: 63, name: 'Pollo, Pavo', status: 'permitido', category: 'Prote√≠nas', notes: 'Sin marinar.' },
      { id: 29, name: 'Pescado y Mariscos', status: 'permitido', category: 'Prote√≠nas', notes: 'Camar√≥n, pulpo, tilapia, etc. Frescos.' },
      { id: 30, name: 'Huevo', status: 'permitido', category: 'Prote√≠nas', notes: '' },
      { id: 7, name: 'Leche sin lactosa', status: 'permitido', category: 'L√°cteos', notes: '' },
      { id: 8, name: 'Yogur sin lactosa', status: 'permitido', category: 'L√°cteos', notes: '' },
      { id: 9, name: 'Quesos curados y duros', status: 'permitido', category: 'L√°cteos', notes: 'Parmesano, manchego, cheddar, suizo.' },
      { id: 59, name: 'Mantequilla', status: 'permitido', category: 'L√°cteos', notes: 'Baja en lactosa.' },
      { id: 171, name: 'Queso Oaxaca (Quesillo)', status: 'permitido', category: 'L√°cteos', notes: 'Generalmente bajo en lactosa por su proceso. Moderar porci√≥n.' },
      { id: 172, name: 'Queso Panela', status: 'permitido', category: 'L√°cteos', notes: 'Generalmente bajo en lactosa. Moderar porci√≥n.' },
      { id: 173, name: 'Crema sin lactosa', status: 'permitido', category: 'L√°cteos', notes: '' },
      { id: 174, name: 'Tortilla de ma√≠z', status: 'permitido', category: 'Panader√≠a', notes: 'Base de la dieta.' },
      { id: 175, name: 'Arepas / Pupusas', status: 'permitido', category: 'Panader√≠a', notes: 'Asegurar que sean 100% ma√≠z, sin harinas de trigo.' },
      { id: 176, name: 'Epazote, Comino, Or√©gano, Pimienta, Clavo, Canela', status: 'permitido', category: 'Condimentos', notes: 'Hierbas y especias secas son permitidas.' },
      { id: 177, name: 'Sal', status: 'permitido', category: 'Condimentos', notes: '' },
      { id: 178, name: 'Mayonesa', status: 'permitido', category: 'Condimentos', notes: 'Revisar que no contenga ajo.' },
      { id: 179, name: 'Mostaza', status: 'permitido', category: 'Condimentos', notes: 'Revisar ingredientes.' },
      { id: 180, name: 'Chocolate negro / amargo', status: 'permitido', category: 'Dulces', notes: 'Alto % de cacao. Con moderaci√≥n.' },
      { id: 181, 'name': 'Cacahuates (man√≠)', 'status': 'permitido', 'category': 'Botanas', 'notes': 'Naturales o salados. Evitar versiones con chile en polvo que pueda tener ajo/cebolla.' },
      { id: 182, 'name': 'Papas fritas naturales', 'status': 'permitido', 'category': 'Botanas', 'notes': 'Solo papa, aceite y sal. Evitar las que tienen condimentos.' },
      { id: 183, 'name': 'Agua natural y de sabor (lim√≥n, pepino, naranja)', 'status': 'permitido', 'category': 'Bebidas', 'notes': '' },
      { id: 184, 'name': 'Caf√© y T√© (negro, verde)', 'status': 'permitido', 'category': 'Bebidas', 'notes': 'Pueden ser irritantes para algunas personas, pero no son altos en FODMAP.' },
      { id: 185, 'name': 'Cerveza', 'status': 'permitido', 'category': 'Bebidas', 'notes': 'Con moderaci√≥n (1 lata). El gluten no es un FODMAP.' },
      { id: 186, 'name': 'Tequila, Mezcal', 'status': 'permitido', 'category': 'Bebidas', 'notes': 'Destilados puros, sin mezclar con refrescos azucarados.' },
      { id: 112, name: 'Ajo', status: 'prohibido', category: 'Verduras', notes: 'Alto en fructanos. Base de muchos guisos.' },
      { id: 113, name: 'Cebolla', status: 'prohibido', category: 'Verduras', notes: 'Alta en fructanos. Base de muchos guisos.' },
      { id: 135, name: 'Camote (batata)', status: 'prohibido', category: 'Verduras', notes: 'En porciones grandes.' },
      { id: 187, name: 'Elote (ma√≠z tierno)', status: 'prohibido', category: 'Verduras', notes: 'Alto en sorbitol. Diferente al grano de ma√≠z seco para tortillas.' },
      { id: 118, name: 'Manzana', status: 'prohibido', category: 'Frutas', notes: 'Alta en fructosa y sorbitol.' },
      { id: 120, name: 'Mango', status: 'prohibido', category: 'Frutas', notes: 'Alto en fructosa.' },
      { id: 121, name: 'Sand√≠a', status: 'prohibido', category: 'Frutas', notes: 'Alta en fructosa y manitol.' },
      { id: 123, name: 'Aguacate (palta)', status: 'prohibido', category: 'Frutas', notes: 'Alto en sorbitol. Porciones muy peque√±as (1/8) pueden ser toleradas.' },
      { id: 188, name: 'Ca√±a de az√∫car', status: 'prohibido', category: 'Frutas', notes: 'Alta en fructanos.' },
      { id: 101, name: 'Trigo', status: 'prohibido', category: 'Cereales', notes: 'En pan, pasta, galletas, etc.' },
      { id: 104, name: 'Garbanzos', status: 'prohibido', category: 'Legumbres', notes: 'Altos en GOS.' },
      { id: 105, name: 'Lentejas', status: 'prohibido', category: 'Legumbres', notes: 'Altas en GOS.' },
      { id: 106, name: 'Frijol (negro, bayo, etc.)', status: 'prohibido', category: 'Legumbres', notes: 'Altos en GOS. Incluye frijoles tiernos.' },
      { id: 108, name: 'Leche de vaca', status: 'prohibido', category: 'L√°cteos', notes: 'A menos que sea sin lactosa.' },
      { id: 109, name: 'Yogur regular', status: 'prohibido', category: 'L√°cteos', notes: 'Contiene lactosa.' },
      { id: 110, name: 'Queso fresco', status: 'prohibido', category: 'L√°cteos', notes: 'Suele ser alto en lactosa.' },
      { id: 189, name: 'Queso crema', status: 'prohibido', category: 'L√°cteos', notes: 'Alto en lactosa.' },
      { id: 190, name: 'Crema regular', status: 'prohibido', category: 'L√°cteos', notes: 'Alta en lactosa.' },
      { id: 191, name: 'Chorizo, Salchicha, Carnes fr√≠as', status: 'prohibido', category: 'Prote√≠nas', notes: 'Suelen contener trigo, ajo, cebolla u otros aditivos altos en FODMAP.' },
      { id: 192, name: 'Tortilla de harina', status: 'prohibido', category: 'Panader√≠a', notes: 'Hecha de trigo.' },
      { id: 193, name: 'Pan dulce (conchas, etc.), Bolillo, Pan de caja', status: 'prohibido', category: 'Panader√≠a', notes: 'Hechos de trigo.' },
      { id: 194, name: 'Galletas (Mar√≠as, Pr√≠ncipe, etc.)', status: 'prohibido', category: 'Panader√≠a', notes: 'Hechas de trigo y a menudo con jarabe de alta fructosa.' },
      { id: 195, name: 'Salsas picantes comerciales', status: 'prohibido', category: 'Condimentos', notes: 'Suelen contener ajo y/o cebolla en polvo.' },
      { id: 196, name: 'K√©tchup', status: 'prohibido', category: 'Condimentos', notes: 'Contiene jarabe de alta fructosa y a menudo cebolla.' },
      { id: 197, name: 'Caldo de pollo en polvo', status: 'prohibido', category: 'Condimentos', notes: 'Casi siempre contiene cebolla y ajo.' },
      { id: 198, name: 'Achiote', status: 'prohibido', category: 'Condimentos', notes: 'Las pastas comerciales suelen tener ajo.' },
      { id: 199, name: 'Mole', status: 'prohibido', category: 'Condimentos', notes: 'Contiene m√∫ltiples ingredientes altos en FODMAP (chiles anchos, ajo, cebolla, a veces chocolate con leche).' },
      { id: 200, name: 'Cajeta / Dulce de leche', status: 'prohibido', category: 'Dulces', notes: 'Hechos con leche regular, altos en lactosa.' },
      { id: 201, name: 'Mazap√°n', status: 'prohibido', category: 'Dulces', notes: 'Contiene cacahuate (bajo FODMAP) pero mucho az√∫car.' },
      { id: 202, name: 'Chocolate de mesa (Abuelita, Ibarra)', status: 'prohibido', category: 'Dulces', notes: 'Contiene leche y mucho az√∫car.' },
      { id: 203, name: 'Nieves y Helados', status: 'prohibido', category: 'Dulces', notes: 'Las de agua suelen tener alta fructosa y las de leche, lactosa.' },
      { id: 204, name: 'Agua de horchata, jamaica, tamarindo', status: 'prohibido', category: 'Bebidas', notes: 'Horchata (arroz es OK, pero se usa leche y canela), jamaica y tamarindo son altos en fructosa.' },
      { id: 205, name: 'Refrescos', status: 'prohibido', category: 'Bebidas', notes: 'Contienen jarabe de ma√≠z de alta fructosa.' },
      { id: 206, name: 'Atole, Champurrado', status: 'prohibido', category: 'Bebidas', notes: 'Hechos con leche regular y/o ma√≠z tierno.' },
      { id: 207, name: 'Jugos embotellados', status: 'prohibido', category: 'Bebidas', notes: 'Altos en fructosa.' },
      { id: 208, name: 'Pulque', status: 'prohibido', category: 'Bebidas', notes: 'Fermentado del aguamiel (agave), alto en fructanos.' },
    ];

    // --- L√ìGICA DE LA APLICACI√ìN ---

    // Utilidad para Almacenamiento Temporal
    const timedStorage = {
        setItem: (key, value, hours) => {
            const now = new Date();
            const item = {
                value: value,
                expiry: now.getTime() + hours * 60 * 60 * 1000,
            };
            localStorage.setItem(key, JSON.stringify(item));
        },
        getItem: (key) => {
            const itemStr = localStorage.getItem(key);
            if (!itemStr) return null;
            const item = JSON.parse(itemStr);
            const now = new Date();
            if (now.getTime() > item.expiry) {
                localStorage.removeItem(key);
                return null;
            }
            return item.value;
        },
    };

    // --- Renderizado de Contenido de Pesta√±as ---

    function renderSearch() {
        const container = document.getElementById('search-content');
        container.innerHTML = `
            <div class="p-4 md:p-6 bg-white rounded-2xl shadow-lg">
                <h2 class="text-2xl font-bold text-gray-800 mb-4 flex items-center">
                    <i data-lucide="search" class="mr-3 text-green-600"></i> Buscador de Alimentos
                </h2>
                <div class="relative">
                    <input id="search-input" type="text" placeholder="Busca un alimento (ej. 'nopal', 'frijol', 'quesillo')"
                           class="w-full p-3 pl-10 border-2 border-gray-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-green-500 transition-all">
                    <i data-lucide="search" class="absolute left-3 top-1/2 -translate-y-1/2 text-gray-400 w-5 h-5"></i>
                </div>
                <div id="search-results" class="mt-4 space-y-2 max-h-60 overflow-y-auto custom-scrollbar"></div>
            </div>`;
        
        const searchInput = document.getElementById('search-input');
        searchInput.addEventListener('input', handleSearch);
    }

    function handleSearch(e) {
        const searchTerm = e.target.value.toLowerCase();
        const resultsContainer = document.getElementById('search-results');
        
        if (searchTerm.length > 1) {
            const results = fodmapData.filter(item => 
                item.name.toLowerCase().includes(searchTerm) || 
                item.notes.toLowerCase().includes(searchTerm)
            );
            
            if (results.length > 0) {
                resultsContainer.innerHTML = results.map(item => `
                    <div class="p-3 rounded-lg flex justify-between items-center ${item.status === 'permitido' ? 'bg-green-100 border-l-4 border-green-500' : 'bg-red-100 border-l-4 border-red-500'}">
                        <div>
                            <p class="font-semibold text-gray-800">${item.name}</p>
                            <p class="text-sm text-gray-600">${item.notes}</p>
                        </div>
                        <span class="px-3 py-1 text-sm font-bold rounded-full text-white ${item.status === 'permitido' ? 'bg-green-500' : 'bg-red-500'}">
                            ${item.status === 'permitido' ? 'Permitido' : 'Evitar'}
                        </span>
                    </div>
                `).join('');
            } else {
                resultsContainer.innerHTML = `<p class="text-center text-gray-500 p-4">No se encontraron resultados.</p>`;
            }
        } else {
            resultsContainer.innerHTML = '';
        }
    }

    function renderGuide() {
        const container = document.getElementById('guide-content');
        const categories = [...new Set(fodmapData.map(item => item.category))];
        container.innerHTML = `
            <div class="p-4 md:p-6 bg-white rounded-2xl shadow-lg">
                <h2 class="text-2xl font-bold text-gray-800 mb-4 flex items-center">
                    <i data-lucide="book-open" class="mr-3 text-green-600"></i> Gu√≠a R√°pida FODMAP
                </h2>
                ${categories.map(category => `
                    <div class="mb-2 border rounded-lg overflow-hidden bg-white">
                        <button class="guide-category-btn w-full flex justify-between items-center p-3 bg-gray-50 hover:bg-gray-100 font-semibold text-gray-700 transition-colors">
                            <span>${category}</span>
                            <i data-lucide="chevron-down" class="transition-transform"></i>
                        </button>
                        <div class="guide-category-content hidden p-4 border-t-2">
                            <h3 class="font-bold text-green-700 mb-2 text-lg">‚úÖ Permitidos</h3>
                            <ul class="list-disc list-inside space-y-1 mb-4 pl-2">
                                ${fodmapData.filter(item => item.category === category && item.status === 'permitido').map(item => `
                                    <li class="text-gray-800">${item.name} <span class="text-sm text-gray-500">${item.notes ? `- ${item.notes}`: ''}</span></li>
                                `).join('') || '<li class="text-gray-500">No hay alimentos permitidos en esta categor√≠a.</li>'}
                            </ul>
                            <h3 class="font-bold text-red-700 mb-2 text-lg">‚ùå A Evitar</h3>
                            <ul class="list-disc list-inside space-y-1 pl-2">
                                ${fodmapData.filter(item => item.category === category && item.status === 'prohibido').map(item => `
                                    <li class="text-gray-800">${item.name} <span class="text-sm text-gray-500">${item.notes ? `- ${item.notes}`: ''}</span></li>
                                `).join('') || '<li class="text-gray-500">No hay alimentos a evitar en esta categor√≠a.</li>'}
                            </ul>
                        </div>
                    </div>
                `).join('')}
            </div>`;
        
        document.querySelectorAll('.guide-category-btn').forEach(button => {
            button.addEventListener('click', () => {
                const content = button.nextElementSibling;
                const icon = button.querySelector('i');
                content.classList.toggle('hidden');
                icon.classList.toggle('rotate-180');
            });
        });
    }
    
    function renderPlanner() {
        const container = document.getElementById('planner-content');
        const days = ['Lunes', 'Martes', 'Mi√©rcoles', 'Jueves', 'Viernes', 'S√°bado', 'Domingo'];
        const meals = ['Desayuno', 'Comida', 'Cena'];
        let plan = timedStorage.getItem('mealPlan') || {};

        function updatePlannerView() {
            let tableHTML = `<table class="w-full border-collapse"><thead><tr class="bg-gray-100"><th class="p-2 border"></th>`;
            days.forEach(day => tableHTML += `<th class="p-2 border font-semibold text-gray-700">${day}</th>`);
            tableHTML += `</tr></thead><tbody>`;
            meals.forEach(meal => {
                tableHTML += `<tr><td class="p-2 border font-semibold text-gray-600">${meal}</td>`;
                days.forEach(day => {
                    const mealText = plan[day]?.[meal] || '<span class="text-gray-400">A√±adir...</span>';
                    tableHTML += `<td data-day="${day}" data-meal="${meal}" class="planner-cell p-2 border text-sm text-gray-700 align-top h-24 hover:bg-gray-50 cursor-pointer"><pre>${mealText}</pre></td>`;
                });
                tableHTML += `</tr>`;
            });
            tableHTML += `</tbody></table>`;
            
            container.innerHTML = `
                <div class="p-4 md:p-6 bg-white rounded-2xl shadow-lg">
                    <h2 class="text-2xl font-bold text-gray-800 mb-4 flex items-center">
                        <i data-lucide="calendar-days" class="mr-3 text-green-600"></i> Planificador Semanal
                    </h2>
                    <div class="overflow-x-auto">${tableHTML}</div>
                </div>`;
            
            document.querySelectorAll('.planner-cell').forEach(cell => {
                cell.addEventListener('click', () => openPlannerModal(cell.dataset.day, cell.dataset.meal));
            });
        }
        
        function openPlannerModal(day, meal) {
            const modal = document.getElementById('planner-modal');
            const title = document.getElementById('modal-title');
            const subtitle = document.getElementById('modal-subtitle');
            const textarea = document.getElementById('modal-textarea');
            
            subtitle.textContent = `${day} - ${meal}`;
            textarea.value = plan[day]?.[meal] || '';
            
            modal.classList.remove('hidden');
            
            document.getElementById('modal-save').onclick = () => {
                if (!plan[day]) plan[day] = {};
                plan[day][meal] = textarea.value;
                timedStorage.setItem('mealPlan', plan, 76);
                updatePlannerView();
                modal.classList.add('hidden');
            };
            
            document.getElementById('modal-cancel').onclick = () => {
                modal.classList.add('hidden');
            };
        }

        updatePlannerView();
    }

    function renderLists() {
        const container = document.getElementById('lists-content');
        let lists = timedStorage.getItem('myLists') || [{ id: 1, name: 'Lista de la Compra', items: [] }];
        let activeList = lists[0];

        function updateListView() {
            const itemsHTML = activeList.items.map(item => `
                <div class="flex items-center justify-between p-3 bg-gray-50 rounded-lg">
                    <div class="flex items-center">
                        <input type="checkbox" data-item-id="${item.id}" ${item.checked ? 'checked' : ''} class="list-item-check h-5 w-5 rounded border-gray-300 text-green-600 focus:ring-green-500 cursor-pointer">
                        <span class="ml-3 text-gray-800 ${item.checked ? 'line-through text-gray-400' : ''}">${item.text}</span>
                    </div>
                    <button data-item-id="${item.id}" class="list-item-delete text-gray-400 hover:text-red-500"><i data-lucide="trash-2" class="w-4 h-4"></i></button>
                </div>
            `).join('');

            container.innerHTML = `
                <div class="p-4 md:p-6 bg-white rounded-2xl shadow-lg">
                    <h2 class="text-2xl font-bold text-gray-800 mb-4 flex items-center">
                        <i data-lucide="list-plus" class="mr-3 text-green-600"></i> Mis Listas
                    </h2>
                    <div class="mb-4"><h3 class="text-lg font-semibold text-gray-700">${activeList.name}</h3></div>
                    <form id="add-item-form" class="flex space-x-2 mb-4">
                        <input id="new-item-input" type="text" placeholder="A√±adir un nuevo art√≠culo" class="flex-grow p-3 border-2 border-gray-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-green-500">
                        <button type="submit" class="bg-green-600 text-white p-3 rounded-xl hover:bg-green-700 flex items-center justify-center"><i data-lucide="plus-circle"></i></button>
                    </form>
                    <div class="space-y-2 max-h-60 overflow-y-auto custom-scrollbar">${itemsHTML}</div>
                </div>`;
            
            lucide.createIcons(); // Re-render icons

            document.getElementById('add-item-form').addEventListener('submit', e => {
                e.preventDefault();
                const input = document.getElementById('new-item-input');
                if (input.value.trim() === '') return;
                activeList.items.push({ id: Date.now(), text: input.value, checked: false });
                timedStorage.setItem('myLists', lists, 76);
                input.value = '';
                updateListView();
            });

            document.querySelectorAll('.list-item-check').forEach(checkbox => {
                checkbox.addEventListener('change', e => {
                    const itemId = parseInt(e.target.dataset.itemId);
                    const item = activeList.items.find(i => i.id === itemId);
                    if (item) item.checked = e.target.checked;
                    timedStorage.setItem('myLists', lists, 76);
                    updateListView();
                });
            });

            document.querySelectorAll('.list-item-delete').forEach(button => {
                button.addEventListener('click', e => {
                    const itemId = parseInt(e.currentTarget.dataset.itemId);
                    activeList.items = activeList.items.filter(i => i.id !== itemId);
                    timedStorage.setItem('myLists', lists, 76);
                    updateListView();
                });
            });
        }

        updateListView();
    }

    function renderPhases() {
        const container = document.getElementById('phases-content');
        container.innerHTML = `
            <div class="p-4 md:p-6 bg-white rounded-2xl shadow-lg">
                <h2 class="text-2xl font-bold text-gray-800 mb-6 flex items-center">
                    <i data-lucide="chevrons-right" class="mr-3 text-green-600"></i> Las 3 Fases de la Dieta FODMAP
                </h2>
                <div class="space-y-8">
                    <div>
                        <h3 class="text-xl font-bold text-green-700 mb-2">Fase 1: Eliminaci√≥n (2-6 semanas)</h3>
                        <p class="text-gray-700">El objetivo es reducir los s√≠ntomas digestivos. Se eliminan de forma estricta todos los alimentos con alto contenido en FODMAP, consumiendo √∫nicamente los "Permitidos".</p>
                    </div>
                    <div>
                        <h3 class="text-xl font-bold text-green-700 mb-2">Fase 2: Reintroducci√≥n</h3>
                        <p class="text-gray-700 mb-4">Una vez sin s√≠ntomas, se reintroducen los alimentos grupo por grupo para descubrir tu tolerancia personal. Es crucial llevar un registro de los s√≠ntomas.</p>
                        <div class="overflow-x-auto">
                            <table class="w-full text-left border-collapse">
                                <thead class="bg-gray-100"><tr><th class="p-3 font-semibold text-gray-700 border-b-2">Grupo FODMAP</th><th class="p-3 font-semibold text-gray-700 border-b-2">Alimento de Prueba</th><th class="p-3 font-semibold text-gray-700 border-b-2">D√≠a 1</th><th class="p-3 font-semibold text-gray-700 border-b-2">D√≠a 3</th><th class="p-3 font-semibold text-gray-700 border-b-2">Descanso</th></tr></thead>
                                <tbody>
                                    <tr class="hover:bg-gray-50"><td class="p-3 border-b">Fructosa</td><td class="p-3 border-b">Miel / Mango</td><td class="p-3 border-b">1 cda / ¬Ω pza</td><td class="p-3 border-b">2 cdas / 1 pza</td><td class="p-3 border-b" rowSpan="8">3-4 d√≠as entre cada grupo</td></tr>
                                    <tr class="hover:bg-gray-50"><td class="p-3 border-b">Lactosa</td><td class="p-3 border-b">Leche / Yogur</td><td class="p-3 border-b">¬Ω vaso / 1 pza</td><td class="p-3 border-b">1.5 vasos / 2 pzas</td></tr>
                                    <tr class="hover:bg-gray-50"><td class="p-3 border-b">GOS</td><td class="p-3 border-b">Lentejas / Frijoles</td><td class="p-3 border-b">¬º taza</td><td class="p-3 border-b">¬Ω taza</td></tr>
                                    <tr class="hover:bg-gray-50"><td class="p-3 border-b">Sorbitol</td><td class="p-3 border-b">Aguacate / Elote</td><td class="p-3 border-b">¬º pza / ¬Ω pza</td><td class="p-3 border-b">¬Ω pza / 1 pza</td></tr>
                                    <tr class="hover:bg-gray-50"><td class="p-3 border-b">Manitol</td><td class="p-3 border-b">Champi√±ones</td><td class="p-3 border-b">¬Ω taza</td><td class="p-3 border-b">1 taza</td></tr>
                                    <tr class="hover:bg-gray-50"><td class="p-3 border-b">Fructosa+Sorbitol</td><td class="p-3 border-b">Manzana / Pera</td><td class="p-3 border-b">¬Ω pieza</td><td class="p-3 border-b">1 pieza</td></tr>
                                    <tr class="hover:bg-gray-50"><td class="p-3 border-b">FOS (Trigo)</td><td class="p-3 border-b">Pan de trigo / Pasta</td><td class="p-3 border-b">1 rebanada / 1 taza</td><td class="p-3 border-b">2-3 rebanadas / plato</td></tr>
                                    <tr class="hover:bg-gray-50"><td class="p-3 border-b">FOS (Ajo/Cebolla)</td><td class="p-3 border-b">Ajo / Cebolla</td><td class="p-3 border-b">¬Ω diente / ¬º pza</td><td class="p-3 border-b">1 diente / ¬Ω pza</td></tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                    <div>
                        <h3 class="text-xl font-bold text-green-700 mb-2">Fase 3: Personalizaci√≥n</h3>
                        <p class="text-gray-700">Con la informaci√≥n de la fase 2, creas tu propia dieta a largo plazo, incluyendo la mayor variedad de alimentos posible y evitando s√≥lo lo que te causa s√≠ntomas.</p>
                    </div>
                </div>
            </div>`;
    }

    function renderDishes() {
        const container = document.getElementById('dishes-content');
        const dishes = [
            { name: 'Tacos (al pastor, bistec, carnitas)', advice: 'La clave es la tortilla de ma√≠z (permitida). Rellena con carne sin marinar. Evita la cebolla y el guacamole (aguacate). Usa cilantro, lim√≥n y salsa casera sin ajo/cebolla (solo tomate, chiles, sal y cilantro). Los de pastor son prohibidos por el marinado (achiote con ajo).', status: 'adaptable' },
            { name: 'Tortas', advice: 'Prohibido por el pan (bolillo/telera de trigo). Una alternativa es hacer la torta con dos rebanadas grandes de pan sin gluten.', status: 'prohibido' },
            { name: 'Pozole', advice: 'El grano de ma√≠z pozolero es bajo en FODMAP. Prepara un caldo solo con la carne, el ma√≠z y hierbas (or√©gano). Sirve con lechuga, r√°bano y lim√≥n. Evita la cebolla, el ajo del caldo y las tostadas de trigo.', status: 'adaptable' },
            { name: 'Enchiladas / Chilaquiles', advice: 'Usa tortillas de ma√≠z. La salsa debe ser casera, licuando solo tomate/tomatillo con chile y sal. Evita la cebolla y el ajo en la salsa. Usa queso Oaxaca/Panela y crema sin lactosa. Evita la cebolla cruda para decorar.', status: 'adaptable' },
            { name: 'Tamales', advice: 'La masa de ma√≠z es permitida. El problema es el relleno. Elige o prepara tamales con rellenos permitidos, como carne de cerdo o pollo en salsa verde (casera, sin ajo/cebolla). Evita los de mole o rajas con queso regular.', status: 'adaptable' },
            { name: 'Mole', advice: 'Prohibido. Contiene m√∫ltiples ingredientes altos en FODMAP como chiles anchos (altos en fructosa), ajo, cebolla y a menudo chocolate con leche.', status: 'prohibido' },
            { name: 'Sopa de fideo', advice: 'Prohibido. La pasta de fideo es de trigo. Podr√≠as hacer una "sopa de arroz" usando un caldo de pollo casero (sin ajo/cebolla) con arroz.', status: 'prohibido' },
            { name: 'Arroz con frijoles', advice: 'El arroz es permitido, pero los frijoles son altos en GOS y est√°n prohibidos en la fase de eliminaci√≥n.', status: 'prohibido' },
            { name: 'Ceviche', advice: 'Es muy adaptable. Usa pescado, lim√≥n, jitomate, pepino y cilantro. Evita la cebolla morada y el aguacate.', status: 'adaptable' },
            { name: 'Lomo Saltado', advice: 'Prohibido en su forma tradicional por la cebolla, el ajo y la salsa de soja (que a menudo contiene trigo).', status: 'prohibido' },
            { name: 'Asado', advice: 'La carne asada es totalmente permitida. El problema son los acompa√±amientos. Evita el chorizo, las salchichas y las ensaladas que lleven aderezos con ajo/cebolla.', status: 'adaptable' },
        ];
        container.innerHTML = `
            <div class="p-4 md:p-6 bg-white rounded-2xl shadow-lg">
                <h2 class="text-2xl font-bold text-gray-800 mb-6 flex items-center">
                    <i data-lucide="utensils-crossed" class="mr-3 text-green-600"></i> Gu√≠a de Platillos T√≠picos
                </h2>
                <div class="space-y-4">
                    ${dishes.map(dish => `
                        <div class="p-4 rounded-lg border-l-4 ${dish.status === 'adaptable' ? 'border-green-500 bg-green-50' : 'border-red-500 bg-red-50'}">
                            <h3 class="font-bold text-lg text-gray-800">${dish.name}</h3>
                            <p class="text-gray-700 mt-1">${dish.advice}</p>
                        </div>
                    `).join('')}
                </div>
            </div>`;
    }

    // --- L√≥gica de Navegaci√≥n ---
    const navButtons = document.querySelectorAll('.nav-button');
    const tabContents = document.querySelectorAll('.tab-content');

    function switchTab(tabId) {
        // Actualizar contenido
        tabContents.forEach(content => {
            content.classList.remove('active');
        });
        document.getElementById(`${tabId}-content`).classList.add('active');

        // Actualizar estilos de botones
        navButtons.forEach(button => {
            if (button.dataset.tab === tabId) {
                if(button.parentElement.id === 'desktop-nav') {
                    button.classList.add('bg-green-600', 'text-white', 'shadow-lg');
                    button.classList.remove('text-gray-600', 'hover:bg-green-100');
                } else {
                    button.classList.add('text-green-600');
                    button.classList.remove('text-gray-500');
                }
            } else {
                 if(button.parentElement.id === 'desktop-nav') {
                    button.classList.remove('bg-green-600', 'text-white', 'shadow-lg');
                    button.classList.add('text-gray-600', 'hover:bg-green-100');
                } else {
                    button.classList.remove('text-green-600');
                    button.classList.add('text-gray-500');
                }
            }
        });
    }

    navButtons.forEach(button => {
        button.addEventListener('click', () => {
            const tabId = button.dataset.tab;
            switchTab(tabId);
        });
    });

    // --- Inicializaci√≥n ---
    function initialize() {
        renderSearch();
        renderGuide();
        renderPlanner();
        renderLists();
        renderPhases();
        renderDishes();
        
        lucide.createIcons();
        switchTab('search'); // Pesta√±a inicial
    }

    initialize();
});
</script>

</body>
</html>
